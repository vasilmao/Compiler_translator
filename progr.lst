     1                                  input:
     2 00000000 4D31C0                  xor r8, r8 ; answer
     3 00000003 4D31C9                  xor r9, r9 ; helper
     4 00000006 4831C0                  xor rax, rax
     5 00000009 BF00000000              mov rdi, 0
     6 0000000E 48BE-                   mov rsi, InBuffer
     6 00000010 [0000000000000000] 
     7 00000018 BA01000000              mov rdx, 1
     8 0000001D 0F05                    syscall
     9                                  
    10 0000001F 803C25[00000000]2D      cmp byte [InBuffer], '-'
    11 00000027 7504                    jne not_minus
    12 00000029 6A01                    push qword 1
    13 0000002B EB04                    jmp after_minus
    14                                  not_minus:
    15 0000002D 6A00                    push qword 0 ; 0 = not minus
    16 0000002F EB19                    jmp deystvie
    17                                  after_minus:
    18                                  
    19                                  InputLoop:
    20 00000031 4831C0                  xor rax, rax
    21 00000034 BF00000000              mov rdi, 0
    22 00000039 48BE-                   mov rsi, InBuffer
    22 0000003B [0000000000000000] 
    23 00000043 BA01000000              mov rdx, 1
    24 00000048 0F05                    syscall
    25                                  deystvie:
    26 0000004A 448A1425[00000000]      mov r10b, byte [InBuffer]
    27 00000052 4983FA30                cmp r10, '0'
    28 00000056 7C1C                    jl InputLoopExit
    29 00000058 4983FA39                cmp r10, '9'
    30 0000005C 7716                    ja InputLoopExit
    31 0000005E 4983EA30                sub r10, '0'
    32 00000062 4D89C1                  mov r9, r8
    33 00000065 49C1E003                shl r8, 3
    34 00000069 49D1E1                  shl r9, 1
    35 0000006C 4D01C8                  add r8, r9
    36 0000006F 4D01D0                  add r8, r10
    37                                  ;push r10
    38 00000072 EBBD                    jmp InputLoop
    39                                  ; need: r8 = r8 * 10
    40                                  InputLoopExit:
    41 00000074 4C89C0                  mov rax, r8
    42 00000077 5B                      pop rbx
    43 00000078 4885DB                  test rbx, rbx
    44 0000007B 7403                    je input_ret
    45 0000007D 48F7D8                  neg rax
    46                                  input_ret:
    47 00000080 C3                      ret
    48                                  
    49                                  print:
    50 00000081 488B442410              mov rax, qword [rsp + 16]
    51 00000086 83F800                  cmp eax, 0d
    52 00000089 7D28                    jge AfterMinus
    53 0000008B 50                      push rax
    54 0000008C B801000000              mov rax, 1
    55 00000091 BF01000000              mov rdi, 1
    56 00000096 C60425[01000000]2D      mov byte [OutBuffer], '-'
    57 0000009E 48BE-                   mov rsi, OutBuffer
    57 000000A0 [0100000000000000] 
    58 000000A8 BA01000000              mov rdx, 1
    59 000000AD 0F05                    syscall
    60 000000AF 58                      pop rax
    61 000000B0 48F7D8                  neg rax
    62                                  AfterMinus:
    63 000000B3 BB0A000000              mov rbx, 10
    64 000000B8 4831D2                      xor rdx, rdx
    65 000000BB 4831FF                      xor rdi, rdi ; counter
    66                                  	StackNumLoop:
    67 000000BE 48F7F3                          div rbx ; rax = res, rdx = mod
    68 000000C1 52                      		push rdx
    69 000000C2 48FFC7                  		inc rdi
    70 000000C5 4831D2                  		xor rdx, rdx
    71 000000C8 4883F800                		cmp rax, 0
    72 000000CC 75F0                    		jne StackNumLoop
    73 000000CE 4831C9                      xor rcx, rcx
    74                                  	BuffNumLoop:
    75 000000D1 58                      		pop rax
    76                                          ;call WriteDigitToBuffer
    77 000000D2 4883C030                        add rax, '0'
    78 000000D6 488981[01000000]                mov [OutBuffer + rcx], rax
    79 000000DD 48FFC1                          inc rcx
    80 000000E0 66FFCF                  		dec di
    81 000000E3 6683FF00                		cmp di, 0
    82 000000E7 75E8                    		jne BuffNumLoop
    83 000000E9 B801000000                  mov rax, 1
    84 000000EE BF01000000                  mov rdi, 1
    85 000000F3 48BE-                       mov rsi, OutBuffer
    85 000000F5 [0100000000000000] 
    86 000000FD 4889CA                      mov rdx, rcx
    87 00000100 0F05                        syscall
    88 00000102 B801000000                  mov rax, 1
    89 00000107 BF01000000                  mov rdi, 1
    90 0000010C 48BE-                       mov rsi, NextLine
    90 0000010E [1400000000000000] 
    91 00000116 BA01000000                  mov rdx, 1
    92 0000011B 0F05                        syscall
    93 0000011D C3                      	ret
    94                                  
    95                                  section .data
    96 00000000 00                      InBuffer: db 0
    97 00000001 00<rep 13h>             OutBuffer: times 19 db 0
    98 00000014 0A                      NextLine: db 0x0a
    99                                  section .text
   100                                  global _start
   101                                  _start:
   102 0000011E 4883EC08                sub rsp, 8
   103                                   ; 48_81 (83 if imm8 instead of imm32)_
   104 00000122 4889E5                  mov rbp, rsp
   105 00000125 E983000000              jmp factorial_END
   106                                  factorial: ;eeee fdecl
   107 0000012A 4883EC00                sub rsp, 0
   108 0000012E 4889E5                  mov rbp, rsp
   109 00000131 4C8B4510                mov r8, [rbp + 16]
   110 00000135 4C89C0                  mov rax, r8
   111 00000138 50                      push rax
   112 00000139 B801000000              mov rax, 1 ; var = const 0x5626b432a190
   113 0000013E 4889C3                  mov rbx, rax
   114 00000141 58                      pop rax
   115 00000142 4831D2                  xor rdx, rdx
   116 00000145 4839D8                  cmp rax, rbx
   117 00000148 B800000000              mov rax, 0
   118 0000014D 0F9EC0                  setle al
   119 00000150 4831DB                  xor rbx, rbx
   120 00000153 88C3                    mov bl, al
   121 00000155 4831C0                  xor rax, rax
   122 00000158 88D8                    mov al, bl
   123 0000015A 4883F800                cmp rax, 0
   124 0000015E 740C                    je LNOT0x5626b432a280 ; this is condition start
   125 00000160 B801000000              mov rax, 1 ; var = const 0x5626b432a220
   126 00000165 4883C400                add rsp, 0
   127 00000169 C3                      ret ; thats it
   128 0000016A EB00                    jmp LEND0x5626b432a280
   129                                  LNOT0x5626b432a280:
   130                                  LEND0x5626b432a280:
   131 0000016C 90                      nop
   132 0000016D 90                      nop ; condition end
   133 0000016E 4C89C0                  mov rax, r8
   134 00000171 50                      push rax
   135 00000172 4C89C0                  mov rax, r8
   136 00000175 50                      push rax
   137 00000176 B801000000              mov rax, 1 ; var = const 0x5626b432a590
   138 0000017B 4889C3                  mov rbx, rax
   139 0000017E 58                      pop rax
   140 0000017F 4831D2                  xor rdx, rdx
   141 00000182 4829D8                  sub rax, rbx
   142 00000185 50                      push rax ; this was argument passing
   143 00000186 4C894510                mov [rbp + 16], r8 ; saving optimized vars
   144 0000018A 55                      push rbp ; save rbp before call
   145 0000018B E89AFFFFFF              call factorial ; the call
   146 00000190 5D                      pop rbp 
   147 00000191 4883C408                add rsp, 8
   148 00000195 4C8B4510                mov r8, [rbp + 16] ; restoring optimized vars
   149 00000199 4889C3                  mov rbx, rax
   150 0000019C 58                      pop rax
   151 0000019D 4831D2                  xor rdx, rdx
   152 000001A0 48F7E3                  mul rbx
   153 000001A3 4883C400                add rsp, 0
   154 000001A7 C3                      ret ; thats it
   155 000001A8 4883C400                add rsp, 0 ; this was fdecl
   156 000001AC C3                      ret
   157                                  factorial_END:
   158 000001AD 4C894500                mov [rbp + 0], r8 ; saving optimized vars
   159 000001B1 55                      push rbp ; save rbp before call
   160 000001B2 E849FEFFFF              call input ; the call
   161 000001B7 5D                      pop rbp 
   162 000001B8 4883C400                add rsp, 0
   163 000001BC 4C8B4500                mov r8, [rbp + 0] ; restoring optimized vars
   164 000001C0 4989C0                  mov r8, rax
   165 000001C3 4C89C0                  mov rax, r8
   166 000001C6 50                      push rax ; this was argument passing
   167 000001C7 4C894500                mov [rbp + 0], r8 ; saving optimized vars
   168 000001CB 55                      push rbp ; save rbp before call
   169 000001CC E859FFFFFF              call factorial ; the call
   170 000001D1 5D                      pop rbp 
   171 000001D2 4883C408                add rsp, 8
   172 000001D6 4C8B4500                mov r8, [rbp + 0] ; restoring optimized vars
   173 000001DA 50                      push rax ; this was argument passing
   174 000001DB 4C894500                mov [rbp + 0], r8 ; saving optimized vars
   175 000001DF 55                      push rbp ; save rbp before call
   176 000001E0 E89CFEFFFF              call print ; the call
   177 000001E5 5D                      pop rbp 
   178 000001E6 4883C408                add rsp, 8
   179 000001EA 4C8B4500                mov r8, [rbp + 0] ; restoring optimized vars
   180 000001EE 4883C408                add rsp, 8
   181 000001F2 B83C000000              mov rax, 0x3C
   182 000001F7 4831FF                  xor rdi, rdi
   183 000001FA 0F05                    syscall
